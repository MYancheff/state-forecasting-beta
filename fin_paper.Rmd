---
title: "fin_paper"
output: github_document
---

```{r}
library(foreign)
library(tidyverse)
library(lubridate)
```

```{r}
IN_SENATE = function(sen_or_house) sen_or_house == 8
IN_HOUSE = function(sen_or_house) sen_or_house == 9
GUESS_DAY = function(day) ifelse(is.na(day),2,day)
DEM_PARTY_CODE = 100
REP_PARTY_CODE = 200
```

```{r}
data = read.dta("data/SLERs1967to2015_20160912b_NV.dta")

tables = lapply(data,table)
info_densty = lapply(tables,dim)
tables["v22"]


named_data = data %>%
  rename(ELECTION_YEAR=v05,
         ELECTION_MONTH=v06,
         ELECTION_DAY=v06b,
         SENATE_OR_HOUSE=v07,
         DISTRICT_NAME=v08,
         ALT_DISTRICT_NAME=v08z,
         DISTRICT_NUM=v09,
         ALT_DISTRICT_NUM=v09z,
         DISTRICT_TYPE=v12,
         NUM_WINNERS_FOR_POS=v13,
         TERM_LENGTH_BY_LAW=v14,
         TERM_LENGTH_ACTUAL=v15,
         ELECTION_TYPE=v16,
         ELECTION_DETERMINES_SITTING_LEG=v17,
         ELECTION_DETERMINES_SITTING_LEG_GEN=v17b,
         CANIDATE_ID=v18,
         PARTY_CODE_DETAILED=v20,
         PARTY_CODE_SIMPLIFIED=v21,
         INCUMBENCY_DUMMY=v22,
         CANIDATE_VOTE_TOTAL=v23,
         ELECTION_WINNER=v24) %>%
  mutate(election_full_date = as.Date(ISOdate(ELECTION_YEAR,ELECTION_MONTH,GUESS_DAY(ELECTION_DAY))),
         party_code = ifelse(PARTY_CODE_SIMPLIFIED == DEM_PARTY_CODE,"DEM",
                           ifelse(PARTY_CODE_SIMPLIFIED == REP_PARTY_CODE,"REP",
                                                                           "OTHER")))

general_election_data = named_data %>%
  filter(ELECTION_DETERMINES_SITTING_LEG==1)

house_data = filter(general_election_data,IN_HOUSE(SENATE_OR_HOUSE)) 

#table(house_data$election_full_date)
#table(named_data$SENATE_OR_HOUSE,useNA="ifany")
```

```{r}
use_data = house_data %>%
  select(ELECTION_WINNER,ELECTION_YEAR,party_code,INCUMBENCY_DUMMY,CANIDATE_VOTE_TOTAL,DISTRICT_NUM)
```

```{r}
beforeyear = 2014

train_data = house_data %>%
  filter(ELECTION_YEAR < beforeyear)
  

model = 

```