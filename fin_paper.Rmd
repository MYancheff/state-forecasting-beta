---
title: "fin_paper"
output: github_document
---

```{r}
library(foreign)
library(tidyverse)
library(lubridate)


source("load_carls.R")
source("load_precinct_data.R")
tot_data = left_join(model_data,pres_summary,by=c("ELECTION_YEAR"="Year","Assembly"="ElectionType","DistrictID"="DISTRICT_ID"))
```

The format of the tidied dataset we want to model is this:

Every row is a (Year, Assembly, District) triple. This is a nice unit because it is the unit we want to run models on. However, none of our data is in this form. All of our data is in a (Year, Canidate) format. So in each dataset, before joining, we need to summarise the sort of covariates we want from that bit of canidate level data.

One of the major necessary transformations is that 

```{r}
beforeyear = 2014

train_data = use_data %>%
  filter(ELECTION_YEAR < beforeyear) %>%
  filter(ELECTION_YEAR > 1970) %>% # we don't have district numbers for 1968 and 1970! (this should be fixable)
  group_by(DISTRICT_NUM,ELECTION_YEAR) %>%
  mutate(percent_vote = CANIDATE_VOTE_TOTAL/sum(CANIDATE_VOTE_TOTAL)) %>%
  ungroup()

pred_perc = lm(percent_vote ~ INCUMBENCY_DUMMY,data=train_data)
```

```{r}
senate_data %>%
  filter(ELECTION_YEAR >= 2012) %>%
  select(ALT_DISTRICT_NUM,DISTRICT_NAME) %>%
  unique()
```

Road citation:

Gary King; Bradley Palmquist; Greg Adams; Micah Altman;
Kenneth Benoit; Claudine Gay; Jeffrey B. Lewis; Russ Mayer;
and Eric Reinhardt. 1997. "The Record of American Democracy, 1984-1990," Harvard University, Cambridge, MA [producer],
Ann Arbor, MI: ICPSR [distributor].